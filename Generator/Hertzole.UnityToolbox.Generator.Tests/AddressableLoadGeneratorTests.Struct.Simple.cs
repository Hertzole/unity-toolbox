using Xunit;

namespace Hertzole.UnityToolbox.Generator.Tests;

partial class AddressableLoadGeneratorTests
{
	public const string ADDRESSABLE_LOAD_STRUCT_SIMPLE_T = @"using Hertzole.UnityToolbox;
using UnityEngine;
using UnityEngine.AddressableAssets;

public partial struct TestStructT
{
	[GenerateLoad]
	public AssetReferenceT<Spawnpoint> assetReference;
}";
	
	public const string ADDRESSABLE_LOAD_STRUCT_SIMPLE = @"using Hertzole.UnityToolbox;
using UnityEngine;
using UnityEngine.AddressableAssets;
 
public partial struct TestStruct
{
 	[GenerateLoad]
 	public AssetReferenceGameObject assetReference;
}";

	private const string EXPECTED_ADDRESSABLE_LOAD_STRUCT_SIMPLE_T = @"// <auto-generated>
// 		This file was generated by the Unity Toolbox Generator, by Hertzole.
// 		Do not edit this file manually
// </auto-generated>

partial struct TestStructT
{
	private global::UnityEngine.ResourceManagement.AsyncOperations.AsyncOperationHandle<global::Hertzole.UnityToolbox.Spawnpoint> assetReferenceHandle;
	[global::JetBrains.Annotations.CanBeNull]
	private global::Hertzole.UnityToolbox.Spawnpoint asset = null;
	private void LoadAssets()
	{
		assetReferenceHandle = global::UnityEngine.AddressableAssets.Addressables.LoadAssetAsync<global::Hertzole.UnityToolbox.Spawnpoint>(assetReference);
		assetReferenceHandle.Completed += (op) =>
		{
			if (op.Status == global::UnityEngine.ResourceManagement.AsyncOperations.AsyncOperationStatus.Succeeded)
			{
				asset = op.Result;
				OnAssetLoaded(op.Result);
			}
			else
			{
				global::UnityEngine.Debug.LogError($""Failed to load reference assetReference with error: {op.OperationException}"");
			}
		};
	}
	private void ReleaseAssets()
	{
		if (assetReferenceHandle.IsValid())
		{
			global::UnityEngine.AddressableAssets.Addressables.Release(assetReferenceHandle);
		}
	}
	partial void OnAssetLoaded(global::Hertzole.UnityToolbox.Spawnpoint value);
}
";
	
	private const string EXPECTED_ADDRESSABLE_LOAD_STRUCT_SIMPLE = @"// <auto-generated>
// 		This file was generated by the Unity Toolbox Generator, by Hertzole.
// 		Do not edit this file manually
// </auto-generated>

partial struct TestStruct
{
	private global::UnityEngine.ResourceManagement.AsyncOperations.AsyncOperationHandle<global::UnityEngine.GameObject> assetReferenceHandle;
	[global::JetBrains.Annotations.CanBeNull]
	private global::UnityEngine.GameObject asset = null;
	private void LoadAssets()
	{
		assetReferenceHandle = global::UnityEngine.AddressableAssets.Addressables.LoadAssetAsync<global::UnityEngine.GameObject>(assetReference);
		assetReferenceHandle.Completed += (op) =>
		{
			if (op.Status == global::UnityEngine.ResourceManagement.AsyncOperations.AsyncOperationStatus.Succeeded)
			{
				asset = op.Result;
				OnAssetLoaded(op.Result);
			}
			else
			{
				global::UnityEngine.Debug.LogError($""Failed to load reference assetReference with error: {op.OperationException}"");
			}
		};
	}
	private void ReleaseAssets()
	{
		if (assetReferenceHandle.IsValid())
		{
			global::UnityEngine.AddressableAssets.Addressables.Release(assetReferenceHandle);
		}
	}
	partial void OnAssetLoaded(global::UnityEngine.GameObject value);
}
";

	[Fact]
	public void Struct_Simple_AssetReferenceT()
	{
		RunTest("TestStructT.Addressables.g.cs", ADDRESSABLE_LOAD_STRUCT_SIMPLE_T, EXPECTED_ADDRESSABLE_LOAD_STRUCT_SIMPLE_T);
	}
	
	[Fact]
	public void Struct_Simple_AssetReference()
	{
		RunTest("TestStruct.Addressables.g.cs", ADDRESSABLE_LOAD_STRUCT_SIMPLE, EXPECTED_ADDRESSABLE_LOAD_STRUCT_SIMPLE);
	}
}